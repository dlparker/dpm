{% extends "base.html" %}


{% block extra_head %}
<style>
    .tree-node {
        border-left: 2px solid hsl(var(--bc) / 0.2);
        margin-left: 0.5rem;
        padding-left: 0.75rem;
    }
    .tree-toggle {
        cursor: pointer;
        user-select: none;
    }
    .tree-toggle:hover {
        background-color: hsl(var(--bc) / 0.1);
    }
    .tree-icon {
        transition: transform 0.2s ease;
    }
    .tree-icon.expanded {
        transform: rotate(90deg);
    }
</style>
{% endblock %}

{% block content %}

<div class="relative min-h-screen">

  <!-- Sidebar / Drawer panel -->
  <aside 
    id="tree-sidebar"
    class="fixed inset-y-0 left-0 z-50 w-[85%] max-w-[320px] -translate-x-full transform bg-base-200 transition-transform duration-300 ease-in-out sm:w-[75%] md:w-1/2 lg:max-w-[50%] lg:w-[50vw] overflow-y-auto"
  >
    <!-- Header inside sidebar with close button -->
    <div class="sticky top-0 z-10 flex items-center justify-between bg-base-200/90 backdrop-blur-sm p-4 border-b border-base-300">
      <h2 class="text-xl font-bold">Targets</h2>
      <button 
        class="btn btn-ghost btn-sm"
        onclick="document.getElementById('tree-sidebar').classList.add('-translate-x-full'); document.getElementById('sidebar-overlay').classList.add('hidden')"
      >
        âœ•
      </button>
    </div>

    <!-- Tree container -->
    <div class="p-4">
      <div
        id="tree-root"
        hx-get="{{ url_for('pm:nav_tree') }}"
        hx-trigger="load"
        hx-swap="innerHTML"
      >
        <div class="flex justify-center p-8">
          <span class="loading loading-spinner loading-lg"></span>
        </div>
      </div>
    </div>
  </aside>

  <!-- Backdrop / overlay (curtain) -->
  <div 
    id="sidebar-overlay"
    class="fixed inset-0 z-40 bg-black/40 hidden transition-opacity duration-300"
    onclick="document.getElementById('tree-sidebar').classList.add('-translate-x-full'); this.classList.add('hidden')"
  ></div>

  <!-- Main content area -->
  <div class="flex flex-col min-h-screen">

    <!-- Top bar with open button (always visible) -->
    <div class="navbar bg-base-100 shadow-sm">
      <div class="flex-none">
        <button 
          class="btn btn-square btn-ghost"
          onclick="document.getElementById('tree-sidebar').classList.remove('-translate-x-full'); document.getElementById('sidebar-overlay').classList.remove('hidden')"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      <div class="flex-1">
        <h1 class="text-xl font-bold">Focus</h1>
      </div>
    </div>

    <!-- Page content -->
  {% block sb_main_content %}{% endblock %}
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Toggle tree node expansion
    function toggleTreeNode(element) {
        const icon = element.querySelector('.tree-icon');
        const children = element.nextElementSibling;

        if (icon) {
            icon.classList.toggle('expanded');
        }

        if (children && children.classList.contains('tree-children')) {
            children.classList.toggle('hidden');
        }
    }
</script>
{% endblock %}
