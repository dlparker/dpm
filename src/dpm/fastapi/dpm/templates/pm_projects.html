{% extends "pm_sb_base.html" %}

{% block title %}Project Management Projects for {{domain}} {% endblock %}

{% block sb_main_content %}
{% if projects %}
<main class="flex-1 p-6">
  <ul class="space-y-1">
    {% for project in projects %}
    <li>
        <div
            class="tree-toggle flex items-center gap-2 p-2 rounded-lg"
            hx-get="{{ url_for('pm:project-children', domain=domain, project_id=project.project_id) }}"
            hx-target="#domain-{{domain}}-project-{{ project.project_id }}-children"
            hx-swap="innerHTML"
            hx-trigger="click once"
            onclick="toggleTreeNode(this)"
        >
            <span class="badge badge-secondary">Project</span>
            <span class="font-medium">{{ project.name }}</span>
            {% if project.description %}
            <span class="text-base-content/50 text-sm truncate max-w-xs">- {{ project.description }}</span>
            {% endif %}
            <a href="{{ url_for('pm:project', domain=domain, project_id=project.project_id) }}"
               class="btn btn-ghost btn-xs ml-auto"
               onclick="event.stopPropagation()"
               title="View project details">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                </svg>
            </a>
        </div>
        <div id="domain-{{domain}}-project-{{ project.project_id }}-children" class="tree-children tree-node hidden">
            <div class="flex items-center gap-2 p-2 text-base-content/50">
                <span class="loading loading-spinner loading-sm"></span>
                <span>Click to load...</span>
            </div>
        </div>
    </li>
    {% endfor %}
  </ul>
{% else %}
<p class="text-base-content/50 italic p-2">No projects in this domain.</p>
{% endif %}
</main>
{% endblock %}
