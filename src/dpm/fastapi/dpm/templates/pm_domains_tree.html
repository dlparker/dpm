{% extends "pm_sb_base.html" %}

{% block title %}Project Management Domains{% endblock %}

{% block sb_main_content %}
<main class="flex-1 p-6">
    <div class="flex items-center gap-2 mb-6">
        <h1 class="text-xl font-bold">Domains</h1>
    </div>

    {% if domains %}
    <div class="tree-collapsible">
    <ul class="space-y-1">
        {% for domain in domains %}
        <li>
            <div
                class="tree-toggle flex items-center gap-2 p-2 rounded-lg hover:bg-base-300 cursor-pointer"
                {% if domain.domain_mode == "software" %}
                hx-get="{{ url_for('sw:nav-domain-items', domain=domain.name) }}"
                {% else %}
                hx-get="{{ url_for('pm:nav-domain-projects', domain=domain.name) }}"
                {% endif %}
                hx-target="#domains-tree-{{ loop.index }}-children"
                hx-swap="innerHTML"
                hx-trigger="click once"
                onclick="toggleTreeNode(this)"
            >
                <svg class="tree-icon w-4 h-4 shrink-0 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                {% if domain.domain_mode == "software" %}
                <span class="badge badge-info badge-sm">SW</span>
                {% else %}
                <span class="badge badge-primary badge-sm">Domain</span>
                {% endif %}
                <span class="font-medium">{{ domain.name }}</span>
                {% if domain.description %}
                <span class="text-base-content/50 text-sm truncate">- {{ domain.description }}</span>
                {% endif %}
                <a href="{{ url_for('pm:domain', domain=domain.name) }}"
                   class="ml-auto opacity-50 hover:opacity-100"
                   onclick="event.stopPropagation()"
                   title="View domain details">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                </a>
            </div>
            <div id="domains-tree-{{ loop.index }}-children" class="tree-children tree-node hidden pl-4">
                <div class="flex items-center gap-2 p-2 text-base-content/50">
                    <span class="loading loading-spinner loading-sm"></span>
                    <span>Click to load...</span>
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>
    </div>
    {% else %}
    <div class="alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <span>No domains configured.</span>
    </div>
    {% endif %}
</main>
{% endblock %}
