<div class="kanban-card bg-base-100 rounded-lg shadow p-3"
     data-task-id="{{ task.swtask_id }}"
     data-blockers="{{ task.blockers_json|default('[]')|e }}">
    <!-- Header with ID and actions -->
    <div class="flex items-center justify-between mb-2">
        <span class="text-xs text-base-content/50 font-mono">ID {{ task.swtask_id }}</span>
        <div class="flex items-center gap-1">
            <button hx-get="{{ url_for('sw:edit-modal', domain=domain, sw_type='task', item_id=task.swtask_id) }}"
                    hx-target="#edit-modal-container"
                    hx-swap="innerHTML"
                    class="btn btn-ghost btn-xs"
                    title="Edit task">
                EDIT
            </button>
            <button hx-post="{{ url_for('sw:board-delete-task', domain=domain) }}"
                    hx-vals='{"task_id": {{ task.swtask_id }}}'
                    hx-confirm="Are you sure you want to delete this task?"
                    hx-target="#board-message"
                    hx-swap="innerHTML"
                    class="btn btn-ghost btn-xs text-error"
                    title="Delete task">
                DELETE
            </button>
        </div>
    </div>

    <!-- Task title -->
    <h3 class="font-bold text-sm mb-2">{{ task.name }}</h3>

    <!-- Guardrail type badge -->
    {% set gt = task.guardrail_type.value %}
    {% if gt == "production" %}
    <span class="badge badge-success badge-xs mb-1">PRODUCTION</span>
    {% elif gt == "mvp" %}
    <span class="badge badge-warning badge-xs mb-1">MVP</span>
    {% elif gt == "prototype" %}
    <span class="badge badge-info badge-xs mb-1">PROTOTYPE</span>
    {% elif gt == "poc" %}
    <span class="badge badge-secondary badge-xs mb-1">POC</span>
    {% elif gt == "study" %}
    <span class="badge badge-accent badge-xs mb-1">STUDY</span>
    {% elif gt == "research" %}
    <span class="badge badge-ghost badge-xs mb-1">RESEARCH</span>
    {% endif %}

    <!-- Story info -->
    {% if task.story_name %}
    <div class="text-xs text-base-content/70 mb-1">
        <span class="text-base-content/50">Story:</span> {{ task.story_name }}
    </div>
    {% else %}
    <div class="text-xs text-base-content/50 mb-1">Direct on epic</div>
    {% endif %}

    <!-- Blocked indicator -->
    {% if task.status == 'Blocked' %}
    <div class="badge badge-error badge-sm mb-2">Blocked</div>
    {% endif %}

    <!-- Blockers list -->
    {% if task.blockers %}
    <div class="text-xs border-t border-base-300 pt-2 mt-2">
        <span class="text-base-content/50">Blocked by</span>
        <span class="text-warning">
            {% for blocker in task.blockers %}{{ blocker.name }}{% if not loop.last %}, {% endif %}{% endfor %}
        </span>
    </div>
    {% endif %}
</div>
